/*2024.01.04  KTO인구감소지역 데이터 종합본 SQL*/
SELECT    SIDO_NM
    , SGG_NM
    , REGN_CTGR
    , SGG_CD
    , CLASS
    , QUADRANT
   , SGG_TOU_NUM/POPL_NUM_2023_10 AS POPL_TOU_RAT
   , MALE_TWNES_VISITR_RAT + MALE_THRTES_VISITR_RAT + FMALE_TWNES_VISITR_RAT + FMALE_THRTES_VISITR_RAT AS VISITR_MZ_RAT
   , SGG_WGT_RFLT_DSTNC_TOU_NUM/SGG_TOU_NUM AS DSTNC_TOU_RAT
   , SGG_CARD_COMPT_AMT/GRDP AS COMPT_GRDP_RAT
   , AVG_STAY_TM
   , AVG_LODG_DAYS
   , TAR_NUM_RAT
   , TURSM_BIZ_RAT
   , CLTUR_TURSM_EXPL_NUM/SGG_CONT_TOU_NUM AS TRAD_COMT_RAT
   , IFMD_NUM/SGG_CONT_TOU_NUM AS INFO_CNT_RAT
   , SOCTY_CORPO_NUM/SGG_CONT_TOU_NUM AS SOCTY_CORPO_RAT
   , CT_TOUR_NUM/SGG_CONT_TOU_NUM AS CT_TOUR_RAT
   , CAR_PUB_ZON_NUM/SGG_CONT_TOU_NUM AS CAR_RAT
    , IFNULL(TURSM_BDGT/TOTL_BDGT,0) AS TOTL_BDGT_CPRS_TURSM_BDGT
    , IFNULL(SNS_MM_AVG_CNT,0) AS SNS_MM_AVG_CNT
    , 1NGHT_VISITR_NUM
    , 2NGHT_VISITR_NUM
    , 3NGHT_VISITR_NUM
    , NTV_TOU_NUM
    , OSD_TOU_NUM
    , FRN_TOU_NUM
    , SGG_TOU_NUM
    , MALE_TENS_VISITR_RAT
    , MALE_TWNES_VISITR_RAT
    , MALE_THRTES_VISITR_RAT
    , MALE_FORTES_VISITR_RAT
    , MALE_FITES_VISITR_RAT
    , MALE_SXTES_VISITR_RAT
    , MALE_SEVNES_VISITR_RAT
    , FMALE_TENS_VISITR_RAT
    , FMALE_TWNES_VISITR_RAT
    , FMALE_THRTES_VISITR_RAT
    , FMALE_FORTES_VISITR_RAT
    , FMALE_FITES_VISITR_RAT
    , FMALE_SXTES_VISITR_RAT
    , FMALE_SEVNES_VISITR_RAT
    , NATUR_TURSM_SRCH_CNT
    , HSTRY_TURSM_SRCH_CNT
    , EXPRC_TURSM_SRCH_CNT
    , ETC_TURSM_SRCH_CNT
    , CLTUR_TURSM_SRCH_CNT
    , LESU_SPTS_SRCH_CNT
    , SHPN_SRCH_CNT
    , FOOD_SRCH_CNT
    , LODG_SRCH_CNT
    , SGG_SRCH_CNT
    , USA_FRGN_VISITR_NUM
    , JPN_FRGN_VISITR_NUM
    , CHN_FRGN_VISITR_NUM
    , HNK_FRGN_VISITR_NUM
    , TWN_FRGN_VISITR_NUM
    , THA_FRGN_VISITR_NUM
    , PHL_FRGN_VISITR_NUM
    , VNM_FRGN_VISITR_NUM
    , IDN_FRGN_VISITR_NUM
    , MYS_FRGN_VISITR_NUM
    , RUS_FRGN_VISITR_NUM
    , SGP_FRGN_VISITR_NUM
    , LODG_TOB_CARD_COMPT_AMT
    , TOUR_TOB_CARD_COMPT_AMT
    , TRS_TOB_CARD_COMPT_AMT
    , SHPN_TOB_CARD_COMPT_AMT
    , SPTM_SVC_TOB_RELA_CARD_COMPT_AMT
    , FOOD_DRK_TOB_RELA_CARD_COMPT_AMT
    , SGG_CARD_COMPT_AMT_5
    , SGG_CARD_COMPT_AMT
    , SEOUL_WGT_RFLT_DSTNC_OJURI_TOU_NUM
    , BUSAN_WGT_RFLT_DSTNC_OJURI_TOU_NUM
    , DAEGU_WGT_RFLT_DSTNC_OJURI_TOU_NUM
    , INCHEON_WGT_RFLT_DSTNC_OJURI_TOU_NUM
    , GWANGJU_WGT_RFLT_DSTNC_OJURI_TOU_NUM
    , DAEJEON_WGT_RFLT_DSTNC_OJURI_TOU_NUM
    , ULSAN_WGT_RFLT_DSTNC_OJURI_TOU_NUM
    , SEJONG_WGT_RFLT_DSTNC_OJURI_TOU_NUM
    , GYEONGGI_WGT_RFLT_DSTNC_OJURI_TOU_NUM
    , GANGWON_WGT_RFLT_DSTNC_OJURI_TOU_NUM
    , CHUNGBUK_WGT_RFLT_DSTNC_OJURI_TOU_NUM
    , CHUNGNAM_WGT_RFLT_DSTNC_OJURI_TOU_NUM
    , JEONBUK_WGT_RFLT_DSTNC_OJURI_TOU_NUM
    , JEONNAM_WGT_RFLT_DSTNC_OJURI_TOU_NUM
    , GYEONGBUK_WGT_RFLT_DSTNC_OJURI_TOU_NUM
    , GYEONGNAM_WGT_RFLT_DSTNC_OJURI_TOU_NUM
    , JEJU_WGT_RFLT_DSTNC_OJURI_TOU_NUM
    , SGG_WGT_RFLT_DSTNC_TOU_NUM
    , SGG_CONT_TOU_NUM
    , NATUR_TAR_NUM
    , ACAD_TAR_NUM
    , RPTS_TAR_NUM
    , SHPN_TAR_NUM
    , FOOD_TAR_NUM
    , LODG_TAR_NUM
    , SGG_TAR_NUM
    , TOTL_BIZ_NUM
    , TOTL_TURSM_BIZ_NUM
    , TURSM_SHPN_NUM
    , TURSM_TRS_NUM
    , TURSM_LODG_NUM
    , TURSM_FOOD_PUB_NUM
    , TOUR_ASSTN_SVC_NUM
    , INTL_MTG_NUM
    , CLTUR_AMSMT_RPTS_IND_NUM
    , CSO_NUM
    , TOTL_WKER_NUM
    , TOTL_MALE_WKER_NUM
    , TOTL_FMALE_WKER_NUM
    , TOTL_TURSM_BIZ_WKER_NUM
    , TOTL_TURSM_BIZ_MALE_WKER_NUM
    , TOTL_TURSM_BIZ_FMALE_WKER_NUM
    , TURSM_SHPN_MALE_WKER_NUM
    , TURSM_SHPN_FMALE_WKER_NUM
    , TURSM_TRS_MALE_WKER_NUM
    , TURSM_TRS_FMALE_WKER_NUM
    , TURSM_LODG_MALE_WKER_NUM
    , TURSM_LODG_FMALE_WKER_NUM
    , TURSM_FOOD_PUB_MALE_WKER_NUM
    , TURSM_FOOD_PUB_FMALE_WKER_NUM
    , TOUR_ASSTN_SVC_MALE_WKER_NUM
    , TOUR_ASSTN_SVC_FMALE_WKER_NUM
    , INTL_MTG_MALE_WKER_NUM
    , INTL_MTG_FMALE_WKER_NUM
    , CLTUR_AMSMT_RPTS_IND_MALE_WKER_NUM
    , CLTUR_AMSMT_RPTS_IND_FMALE_WKER_NUM
    , CSO_MALE_WKER_NUM
    , CSO_FMALE_WKER_NUM
    , FSTV_NUM_SGG
    , FSTV_NUM_SIDO
    , FSTV_NUM
    , TURSM_BDGT
    , TOTL_BDGT
    , SOCTY_CORPO_NUM
    , IFMD_NUM
    , CLTUR_TURSM_EXPL_NUM
    , CT_TOUR_NUM_SGG
    , CT_TOUR_NUM_SIDO
    , CT_TOUR_NUM
    , CAR_PUB_ZON_NUM
    , MRKT_TOTL_SHOP_NUM
    , MRKT_EMT_SHOP_NUM
    , MRKT_EMT_SHOP_RAT
    , TURSM_WKER_RAT
    , 5YEAR_POPL
    , POPL_DNSTY_RAT
    , YOUTH_PUR_MVMN_RAT
    , DTME_POPL_NUM
    , AGN_RAT
    , BOYHD_RAT
    , BORN_RATE
    , OSF_IMP_ANREV_AF_RAT
    , TENS_BLOW_POPL_NUM
    , TENS_POPL_NUM
    , TWNES_POPL_NUM
    , THRTES_POPL_NUM
    , FORTES_POPL_NUM
    , FITES_POPL_NUM
    , SXTES_POPL_NUM
    , SEVNES_OVER_POPL_NUM
    , POPL_NUM_2018
    , POPL_NUM_2022
    , POPL_NUM_2023_10
    , GOVERN_2021
    , GOVERN_2022
    , GOVERN_2023
    , FRN_POPL_NUM
    , BUS_STA_NUM
    , TR_TRE_NUM
    , TR_NUM
    , AIRPT_NUM
    , ITR_BUS_STA_NUM
    , BUS_TRE_NUM
    , TRAIN_TK_NUM
    , TRAIN_QU_NUM
    , AIR_AVG_SPLY_SEAT_NUM
    , AIR_AVG_SLNG_FMTN_NUM
    , AIR_AVG_PSG_NM_NUM
    , ROAD_PACK_RAT_2021
    , HIWY_ROAD_IC_ACCS_RAT_2021
    , HIWY_HIGH_RIRD_ACCS_RAT_2021
    , PRL_SVC_BNDRY_POPL_RAT_2021
    , GRDP
FROM 
(
SELECT    T990.*
   , IFNULL(T991.RESULT_GROUP,'GROUP_99') AS QUADRANT
   , T101.1NGHT_VISITR_NUM
   , T101.2NGHT_VISITR_NUM
   , T101.3NGHT_VISITR_NUM
   , T101.NTV_TOU_NUM
   , T101.OSD_TOU_NUM
   , T101.FRN_TOU_NUM
   , T101.SGG_TOU_NUM
   , T101.MALE_TENS_VISITR_RAT
   , T101.MALE_TWNES_VISITR_RAT
   , T101.MALE_THRTES_VISITR_RAT
   , T101.MALE_FORTES_VISITR_RAT
   , T101.MALE_FITES_VISITR_RAT
   , T101.MALE_SXTES_VISITR_RAT
   , T101.MALE_SEVNES_VISITR_RAT
   , T101.FMALE_TENS_VISITR_RAT
   , T101.FMALE_TWNES_VISITR_RAT
   , T101.FMALE_THRTES_VISITR_RAT
   , T101.FMALE_FORTES_VISITR_RAT
   , T101.FMALE_FITES_VISITR_RAT
   , T101.FMALE_SXTES_VISITR_RAT
   , T101.FMALE_SEVNES_VISITR_RAT
   , T101.NATUR_TURSM_SRCH_CNT
   , T101.HSTRY_TURSM_SRCH_CNT
   , T101.EXPRC_TURSM_SRCH_CNT
   , T101.ETC_TURSM_SRCH_CNT
   , T101.CLTUR_TURSM_SRCH_CNT
   , T101.LESU_SPTS_SRCH_CNT
   , T101.SHPN_SRCH_CNT
   , T101.FOOD_SRCH_CNT
   , T101.LODG_SRCH_CNT
   , T101.SGG_SRCH_CNT
   , T101.USA_FRGN_VISITR_NUM
   , T101.JPN_FRGN_VISITR_NUM
   , T101.CHN_FRGN_VISITR_NUM
   , T101.HNK_FRGN_VISITR_NUM
   , T101.TWN_FRGN_VISITR_NUM
   , T101.THA_FRGN_VISITR_NUM
   , T101.PHL_FRGN_VISITR_NUM
   , T101.VNM_FRGN_VISITR_NUM
   , T101.IDN_FRGN_VISITR_NUM
   , T101.MYS_FRGN_VISITR_NUM
   , T101.RUS_FRGN_VISITR_NUM
   , T101.SGP_FRGN_VISITR_NUM
   , T101.LODG_TOB_CARD_COMPT_AMT
   , T101.TOUR_TOB_CARD_COMPT_AMT
   , T101.TRS_TOB_CARD_COMPT_AMT
   , T101.SHPN_TOB_CARD_COMPT_AMT
   , T101.SPTM_SVC_TOB_RELA_CARD_COMPT_AMT
   , T101.FOOD_DRK_TOB_RELA_CARD_COMPT_AMT
   , T101.SGG_CARD_COMPT_AMT_5
   , T101.SGG_CARD_COMPT_AMT
   , T101.SEOUL_WGT_RFLT_DSTNC_OJURI_TOU_NUM
   , T101.BUSAN_WGT_RFLT_DSTNC_OJURI_TOU_NUM
   , T101.DAEGU_WGT_RFLT_DSTNC_OJURI_TOU_NUM
   , T101.INCHEON_WGT_RFLT_DSTNC_OJURI_TOU_NUM
   , T101.GWANGJU_WGT_RFLT_DSTNC_OJURI_TOU_NUM
   , T101.DAEJEON_WGT_RFLT_DSTNC_OJURI_TOU_NUM
   , T101.ULSAN_WGT_RFLT_DSTNC_OJURI_TOU_NUM
   , T101.SEJONG_WGT_RFLT_DSTNC_OJURI_TOU_NUM
   , T101.GYEONGGI_WGT_RFLT_DSTNC_OJURI_TOU_NUM
   , T101.GANGWON_WGT_RFLT_DSTNC_OJURI_TOU_NUM
   , T101.CHUNGBUK_WGT_RFLT_DSTNC_OJURI_TOU_NUM
   , T101.CHUNGNAM_WGT_RFLT_DSTNC_OJURI_TOU_NUM
   , T101.JEONBUK_WGT_RFLT_DSTNC_OJURI_TOU_NUM
   , T101.JEONNAM_WGT_RFLT_DSTNC_OJURI_TOU_NUM
   , T101.GYEONGBUK_WGT_RFLT_DSTNC_OJURI_TOU_NUM
   , T101.GYEONGNAM_WGT_RFLT_DSTNC_OJURI_TOU_NUM
   , T101.JEJU_WGT_RFLT_DSTNC_OJURI_TOU_NUM
   , T101.SGG_WGT_RFLT_DSTNC_TOU_NUM
   , T101_1.SGG_CONT_TOU_NUM
   , T101_2.AVG_LODG_DAYS
   , T101_3.AVG_STAY_TM
   , T102.NATUR_TAR_NUM
   , T102.ACAD_TAR_NUM
   , T102.RPTS_TAR_NUM
   , T102.SHPN_TAR_NUM
   , T102.FOOD_TAR_NUM
   , T102.LODG_TAR_NUM
   , T102.SGG_TAR_NUM
   , T102_1.TAR_NUM_RAT
   , T102.TOTL_BIZ_NUM
   , T102.TOTL_TURSM_BIZ_NUM
   , T102.TURSM_SHPN_NUM
   , T102.TURSM_TRS_NUM
   , T102.TURSM_LODG_NUM
   , T102.TURSM_FOOD_PUB_NUM
   , T102.TOUR_ASSTN_SVC_NUM
   , T102.INTL_MTG_NUM
   , T102.CLTUR_AMSMT_RPTS_IND_NUM
   , T102.CSO_NUM
   , T102.TOTL_WKER_NUM
   , T102.TOTL_MALE_WKER_NUM
   , T102.TOTL_FMALE_WKER_NUM
   , T102.TOTL_TURSM_BIZ_WKER_NUM
   , T102.TOTL_TURSM_BIZ_MALE_WKER_NUM
   , T102.TOTL_TURSM_BIZ_FMALE_WKER_NUM
   , T102.TURSM_SHPN_MALE_WKER_NUM
   , T102.TURSM_SHPN_FMALE_WKER_NUM
   , T102.TURSM_TRS_MALE_WKER_NUM
   , T102.TURSM_TRS_FMALE_WKER_NUM
   , T102.TURSM_LODG_MALE_WKER_NUM
   , T102.TURSM_LODG_FMALE_WKER_NUM
   , T102.TURSM_FOOD_PUB_MALE_WKER_NUM
   , T102.TURSM_FOOD_PUB_FMALE_WKER_NUM
   , T102.TOUR_ASSTN_SVC_MALE_WKER_NUM
   , T102.TOUR_ASSTN_SVC_FMALE_WKER_NUM
   , T102.INTL_MTG_MALE_WKER_NUM
   , T102.INTL_MTG_FMALE_WKER_NUM
   , T102.CLTUR_AMSMT_RPTS_IND_MALE_WKER_NUM
   , T102.CLTUR_AMSMT_RPTS_IND_FMALE_WKER_NUM
   , T102.CSO_MALE_WKER_NUM
   , T102.CSO_FMALE_WKER_NUM
   , T102.FSTV_NUM_SGG
   , T102.FSTV_NUM_SIDO
   , T102.TURSM_BDGT
   , T102.TOTL_BDGT
   , T102.TOTL_BDGT_CPRS_TURSM_BDGT
   , T102.SOCTY_CORPO_NUM
   , T102.IFMD_NUM
   , T102.CLTUR_TURSM_EXPL_NUM
   , T102.CT_TOUR_NUM_SGG
   , T102.CT_TOUR_NUM_SIDO
   , T102.CAR_PUB_ZON_NUM
   , T102.MRKT_TOTL_SHOP_NUM
   , T102.MRKT_EMT_SHOP_NUM
   , T102.MRKT_EMT_SHOP_RAT
   , T102.FSTV_NUM
   , T102.CT_TOUR_NUM
   , T102.TURSM_BIZ_RAT
   , T102.TURSM_WKER_RAT
   , T103.5YEAR_POPL
   , T103.POPL_DNSTY_RAT
   , T103.YOUTH_PUR_MVMN_RAT
   , T103.DTME_POPL_NUM
   , T103.AGN_RAT
   , T103.BOYHD_RAT
   , T103.BORN_RATE
   , T103.OSF_IMP_ANREV_AF_RAT
   , T103.TENS_BLOW_POPL_NUM
   , T103.TENS_POPL_NUM
   , T103.TWNES_POPL_NUM
   , T103.THRTES_POPL_NUM
   , T103.FORTES_POPL_NUM
   , T103.FITES_POPL_NUM
   , T103.SXTES_POPL_NUM
   , T103.SEVNES_OVER_POPL_NUM
   , T103.POPL_NUM_2018
   , T103.POPL_NUM_2022
   , T103.POPL_NUM_2023_10
   , T103.GOVERN_2021
   , T103.GOVERN_2022
   , T103.GOVERN_2023
   , T103.FRN_POPL_NUM
   , T103.BUS_STA_NUM
   , T103.TR_TRE_NUM
   , T103.TR_NUM
   , T103.AIRPT_NUM
   , T103.ITR_BUS_STA_NUM
   , T103.BUS_TRE_NUM
   , T103.TRAIN_TK_NUM
   , T103.TRAIN_QU_NUM
   , T103.AIR_AVG_SPLY_SEAT_NUM
   , T103.AIR_AVG_SLNG_FMTN_NUM
   , T103.AIR_AVG_PSG_NM_NUM
   , T103.ROAD_PACK_RAT_2021
   , T103.HIWY_ROAD_IC_ACCS_RAT_2021
   , T103.HIWY_HIGH_RIRD_ACCS_RAT_2021
   , T103.PRL_SVC_BNDRY_POPL_RAT_2021
   , T103.GRDP
   , T104.SNS_MM_AVG_CNT
FROM (SELECT T_A.*, IFNULL(T_B.class, '9999') AS class
   FROM (SELECT DISTINCT sido_nm, sgg_nm, sgg_cd, regn_ctgr
   FROM dw.`02_tursm_resr`) T_A  
   LEFT outer JOIN
    ods.TEST07_CLASS6 T_B
   ON T_A.sgg_cd = T_B.SGG_CD) T990
LEFT OUTER JOIN 
   ods.sido_sgg_group T991
ON    T990.SGG_CD = T991.SGG_CD
LEFT OUTER JOIN 
   (SELECT SGG_CD
           ,AVG(1NGHT_VISITR_NUM)   AS   1NGHT_VISITR_NUM
        ,AVG(2NGHT_VISITR_NUM)   AS   2NGHT_VISITR_NUM
        ,AVG(3NGHT_VISITR_NUM)   AS   3NGHT_VISITR_NUM
        ,AVG(NTV_TOU_NUM)   AS   NTV_TOU_NUM
        ,AVG(OSD_TOU_NUM)   AS   OSD_TOU_NUM
        ,AVG(FRN_TOU_NUM)   AS   FRN_TOU_NUM
        ,ROUND(AVG(NTV_TOU_NUM+OSD_TOU_NUM+FRN_TOU_NUM),0)   AS   SGG_TOU_NUM
        ,AVG(MALE_TENS_VISITR_RAT) / AVG(MALE_TENS_VISITR_RAT+MALE_TWNES_VISITR_RAT+MALE_THRTES_VISITR_RAT+
      MALE_FORTES_VISITR_RAT+MALE_FITES_VISITR_RAT+MALE_SXTES_VISITR_RAT+MALE_SEVNES_VISITR_RAT+
      FMALE_TENS_VISITR_RAT+FMALE_TWNES_VISITR_RAT +FMALE_THRTES_VISITR_RAT+
      FMALE_FORTES_VISITR_RAT+FMALE_FITES_VISITR_RAT+FMALE_SXTES_VISITR_RAT+FMALE_SEVNES_VISITR_RAT)   AS   MALE_TENS_VISITR_RAT
        ,AVG(MALE_TWNES_VISITR_RAT) / AVG(MALE_TENS_VISITR_RAT+MALE_TWNES_VISITR_RAT+MALE_THRTES_VISITR_RAT+
      MALE_FORTES_VISITR_RAT+MALE_FITES_VISITR_RAT+MALE_SXTES_VISITR_RAT+MALE_SEVNES_VISITR_RAT+
      FMALE_TENS_VISITR_RAT+FMALE_TWNES_VISITR_RAT +FMALE_THRTES_VISITR_RAT+
      FMALE_FORTES_VISITR_RAT+FMALE_FITES_VISITR_RAT+FMALE_SXTES_VISITR_RAT+FMALE_SEVNES_VISITR_RAT)   AS   MALE_TWNES_VISITR_RAT
        ,AVG(MALE_THRTES_VISITR_RAT) / AVG(MALE_TENS_VISITR_RAT+MALE_TWNES_VISITR_RAT+MALE_THRTES_VISITR_RAT+
      MALE_FORTES_VISITR_RAT+MALE_FITES_VISITR_RAT+MALE_SXTES_VISITR_RAT+MALE_SEVNES_VISITR_RAT+
      FMALE_TENS_VISITR_RAT+FMALE_TWNES_VISITR_RAT +FMALE_THRTES_VISITR_RAT+
      FMALE_FORTES_VISITR_RAT+FMALE_FITES_VISITR_RAT+FMALE_SXTES_VISITR_RAT+FMALE_SEVNES_VISITR_RAT)   AS   MALE_THRTES_VISITR_RAT
        ,AVG(MALE_FORTES_VISITR_RAT) / AVG(MALE_TENS_VISITR_RAT+MALE_TWNES_VISITR_RAT+MALE_THRTES_VISITR_RAT+
      MALE_FORTES_VISITR_RAT+MALE_FITES_VISITR_RAT+MALE_SXTES_VISITR_RAT+MALE_SEVNES_VISITR_RAT+
      FMALE_TENS_VISITR_RAT+FMALE_TWNES_VISITR_RAT +FMALE_THRTES_VISITR_RAT+
      FMALE_FORTES_VISITR_RAT+FMALE_FITES_VISITR_RAT+FMALE_SXTES_VISITR_RAT+FMALE_SEVNES_VISITR_RAT)   AS   MALE_FORTES_VISITR_RAT
        ,AVG(MALE_FITES_VISITR_RAT) / AVG(MALE_TENS_VISITR_RAT+MALE_TWNES_VISITR_RAT+MALE_THRTES_VISITR_RAT+
      MALE_FORTES_VISITR_RAT+MALE_FITES_VISITR_RAT+MALE_SXTES_VISITR_RAT+MALE_SEVNES_VISITR_RAT+
      FMALE_TENS_VISITR_RAT+FMALE_TWNES_VISITR_RAT +FMALE_THRTES_VISITR_RAT+
      FMALE_FORTES_VISITR_RAT+FMALE_FITES_VISITR_RAT+FMALE_SXTES_VISITR_RAT+FMALE_SEVNES_VISITR_RAT)   AS   MALE_FITES_VISITR_RAT
        ,AVG(MALE_SXTES_VISITR_RAT) / AVG(MALE_TENS_VISITR_RAT+MALE_TWNES_VISITR_RAT+MALE_THRTES_VISITR_RAT+
      MALE_FORTES_VISITR_RAT+MALE_FITES_VISITR_RAT+MALE_SXTES_VISITR_RAT+MALE_SEVNES_VISITR_RAT+
      FMALE_TENS_VISITR_RAT+FMALE_TWNES_VISITR_RAT +FMALE_THRTES_VISITR_RAT+
      FMALE_FORTES_VISITR_RAT+FMALE_FITES_VISITR_RAT+FMALE_SXTES_VISITR_RAT+FMALE_SEVNES_VISITR_RAT)   AS   MALE_SXTES_VISITR_RAT
        ,AVG(MALE_SEVNES_VISITR_RAT) / AVG(MALE_TENS_VISITR_RAT+MALE_TWNES_VISITR_RAT+MALE_THRTES_VISITR_RAT+
      MALE_FORTES_VISITR_RAT+MALE_FITES_VISITR_RAT+MALE_SXTES_VISITR_RAT+MALE_SEVNES_VISITR_RAT+
      FMALE_TENS_VISITR_RAT+FMALE_TWNES_VISITR_RAT +FMALE_THRTES_VISITR_RAT+
      FMALE_FORTES_VISITR_RAT+FMALE_FITES_VISITR_RAT+FMALE_SXTES_VISITR_RAT+FMALE_SEVNES_VISITR_RAT)   AS   MALE_SEVNES_VISITR_RAT
        ,AVG(FMALE_TENS_VISITR_RAT) / AVG(MALE_TENS_VISITR_RAT+MALE_TWNES_VISITR_RAT+MALE_THRTES_VISITR_RAT+
      MALE_FORTES_VISITR_RAT+MALE_FITES_VISITR_RAT+MALE_SXTES_VISITR_RAT+MALE_SEVNES_VISITR_RAT+
      FMALE_TENS_VISITR_RAT+FMALE_TWNES_VISITR_RAT +FMALE_THRTES_VISITR_RAT+
      FMALE_FORTES_VISITR_RAT+FMALE_FITES_VISITR_RAT+FMALE_SXTES_VISITR_RAT+FMALE_SEVNES_VISITR_RAT)   AS   FMALE_TENS_VISITR_RAT
        ,AVG(FMALE_TWNES_VISITR_RAT) / AVG(MALE_TENS_VISITR_RAT+MALE_TWNES_VISITR_RAT+MALE_THRTES_VISITR_RAT+
      MALE_FORTES_VISITR_RAT+MALE_FITES_VISITR_RAT+MALE_SXTES_VISITR_RAT+MALE_SEVNES_VISITR_RAT+
      FMALE_TENS_VISITR_RAT+FMALE_TWNES_VISITR_RAT +FMALE_THRTES_VISITR_RAT+
      FMALE_FORTES_VISITR_RAT+FMALE_FITES_VISITR_RAT+FMALE_SXTES_VISITR_RAT+FMALE_SEVNES_VISITR_RAT)   AS   FMALE_TWNES_VISITR_RAT
        ,AVG(FMALE_THRTES_VISITR_RAT) / AVG(MALE_TENS_VISITR_RAT+MALE_TWNES_VISITR_RAT+MALE_THRTES_VISITR_RAT+
      MALE_FORTES_VISITR_RAT+MALE_FITES_VISITR_RAT+MALE_SXTES_VISITR_RAT+MALE_SEVNES_VISITR_RAT+
      FMALE_TENS_VISITR_RAT+FMALE_TWNES_VISITR_RAT +FMALE_THRTES_VISITR_RAT+
      FMALE_FORTES_VISITR_RAT+FMALE_FITES_VISITR_RAT+FMALE_SXTES_VISITR_RAT+FMALE_SEVNES_VISITR_RAT)   AS   FMALE_THRTES_VISITR_RAT
        ,AVG(FMALE_FORTES_VISITR_RAT) / AVG(MALE_TENS_VISITR_RAT+MALE_TWNES_VISITR_RAT+MALE_THRTES_VISITR_RAT+
      MALE_FORTES_VISITR_RAT+MALE_FITES_VISITR_RAT+MALE_SXTES_VISITR_RAT+MALE_SEVNES_VISITR_RAT+
      FMALE_TENS_VISITR_RAT+FMALE_TWNES_VISITR_RAT +FMALE_THRTES_VISITR_RAT+
      FMALE_FORTES_VISITR_RAT+FMALE_FITES_VISITR_RAT+FMALE_SXTES_VISITR_RAT+FMALE_SEVNES_VISITR_RAT)   AS   FMALE_FORTES_VISITR_RAT
        ,AVG(FMALE_FITES_VISITR_RAT) / AVG(MALE_TENS_VISITR_RAT+MALE_TWNES_VISITR_RAT+MALE_THRTES_VISITR_RAT+
      MALE_FORTES_VISITR_RAT+MALE_FITES_VISITR_RAT+MALE_SXTES_VISITR_RAT+MALE_SEVNES_VISITR_RAT+
      FMALE_TENS_VISITR_RAT+FMALE_TWNES_VISITR_RAT +FMALE_THRTES_VISITR_RAT+
      FMALE_FORTES_VISITR_RAT+FMALE_FITES_VISITR_RAT+FMALE_SXTES_VISITR_RAT+FMALE_SEVNES_VISITR_RAT)   AS   FMALE_FITES_VISITR_RAT
        ,AVG(FMALE_SXTES_VISITR_RAT) / AVG(MALE_TENS_VISITR_RAT+MALE_TWNES_VISITR_RAT+MALE_THRTES_VISITR_RAT+
      MALE_FORTES_VISITR_RAT+MALE_FITES_VISITR_RAT+MALE_SXTES_VISITR_RAT+MALE_SEVNES_VISITR_RAT+
      FMALE_TENS_VISITR_RAT+FMALE_TWNES_VISITR_RAT +FMALE_THRTES_VISITR_RAT+
      FMALE_FORTES_VISITR_RAT+FMALE_FITES_VISITR_RAT+FMALE_SXTES_VISITR_RAT+FMALE_SEVNES_VISITR_RAT)   AS   FMALE_SXTES_VISITR_RAT
        ,AVG(FMALE_SEVNES_VISITR_RAT) / AVG(MALE_TENS_VISITR_RAT+MALE_TWNES_VISITR_RAT+MALE_THRTES_VISITR_RAT+
      MALE_FORTES_VISITR_RAT+MALE_FITES_VISITR_RAT+MALE_SXTES_VISITR_RAT+MALE_SEVNES_VISITR_RAT+
      FMALE_TENS_VISITR_RAT+FMALE_TWNES_VISITR_RAT +FMALE_THRTES_VISITR_RAT+
      FMALE_FORTES_VISITR_RAT+FMALE_FITES_VISITR_RAT+FMALE_SXTES_VISITR_RAT+FMALE_SEVNES_VISITR_RAT)   AS   FMALE_SEVNES_VISITR_RAT
        ,AVG(NATUR_TURSM_SRCH_CNT)   AS   NATUR_TURSM_SRCH_CNT
        ,AVG(HSTRY_TURSM_SRCH_CNT)   AS   HSTRY_TURSM_SRCH_CNT
        ,AVG(EXPRC_TURSM_SRCH_CNT)   AS   EXPRC_TURSM_SRCH_CNT
        ,AVG(ETC_TURSM_SRCH_CNT)   AS   ETC_TURSM_SRCH_CNT
        ,AVG(CLTUR_TURSM_SRCH_CNT)   AS   CLTUR_TURSM_SRCH_CNT
        ,AVG(LESU_SPTS_SRCH_CNT)   AS   LESU_SPTS_SRCH_CNT
        ,AVG(SHPN_SRCH_CNT)   AS   SHPN_SRCH_CNT
        ,AVG(FOOD_SRCH_CNT)   AS   FOOD_SRCH_CNT
        ,AVG(LODG_SRCH_CNT)   AS   LODG_SRCH_CNT
        ,ROUND(AVG(NATUR_TURSM_SRCH_CNT
               +HSTRY_TURSM_SRCH_CNT
               +EXPRC_TURSM_SRCH_CNT
               +ETC_TURSM_SRCH_CNT
               +CLTUR_TURSM_SRCH_CNT
               +LESU_SPTS_SRCH_CNT
               +SHPN_SRCH_CNT
               +FOOD_SRCH_CNT
               +LODG_SRCH_CNT),0)   AS   SGG_SRCH_CNT
        ,AVG(USA_FRGN_VISITR_NUM)   AS   USA_FRGN_VISITR_NUM
        ,AVG(JPN_FRGN_VISITR_NUM)   AS   JPN_FRGN_VISITR_NUM
        ,AVG(CHN_FRGN_VISITR_NUM)   AS   CHN_FRGN_VISITR_NUM
        ,AVG(HNK_FRGN_VISITR_NUM)   AS   HNK_FRGN_VISITR_NUM
        ,AVG(TWN_FRGN_VISITR_NUM)   AS   TWN_FRGN_VISITR_NUM
        ,AVG(THA_FRGN_VISITR_NUM)   AS   THA_FRGN_VISITR_NUM
        ,AVG(PHL_FRGN_VISITR_NUM)   AS   PHL_FRGN_VISITR_NUM
        ,AVG(VNM_FRGN_VISITR_NUM)   AS   VNM_FRGN_VISITR_NUM
        ,AVG(IDN_FRGN_VISITR_NUM)   AS   IDN_FRGN_VISITR_NUM
        ,AVG(MYS_FRGN_VISITR_NUM)   AS   MYS_FRGN_VISITR_NUM
        ,AVG(RUS_FRGN_VISITR_NUM)   AS   RUS_FRGN_VISITR_NUM
        ,AVG(SGP_FRGN_VISITR_NUM)   AS   SGP_FRGN_VISITR_NUM
        ,AVG(LODG_TOB_CARD_COMPT_AMT)   AS   LODG_TOB_CARD_COMPT_AMT
        ,AVG(TOUR_TOB_CARD_COMPT_AMT)   AS   TOUR_TOB_CARD_COMPT_AMT
        ,AVG(TRS_TOB_CARD_COMPT_AMT)   AS   TRS_TOB_CARD_COMPT_AMT
        ,AVG(SHPN_TOB_CARD_COMPT_AMT)   AS   SHPN_TOB_CARD_COMPT_AMT
        ,AVG(SPTM_SVC_TOB_RELA_CARD_COMPT_AMT)   AS   SPTM_SVC_TOB_RELA_CARD_COMPT_AMT
        ,AVG(FOOD_DRK_TOB_RELA_CARD_COMPT_AMT)   AS   FOOD_DRK_TOB_RELA_CARD_COMPT_AMT
        ,AVG(LODG_TOB_CARD_COMPT_AMT+TOUR_TOB_CARD_COMPT_AMT+SHPN_TOB_CARD_COMPT_AMT+SPTM_SVC_TOB_RELA_CARD_COMPT_AMT+ FOOD_DRK_TOB_RELA_CARD_COMPT_AMT)   AS   SGG_CARD_COMPT_AMT_5
        ,AVG(LODG_TOB_CARD_COMPT_AMT+TOUR_TOB_CARD_COMPT_AMT+SHPN_TOB_CARD_COMPT_AMT+SPTM_SVC_TOB_RELA_CARD_COMPT_AMT+ FOOD_DRK_TOB_RELA_CARD_COMPT_AMT+TRS_TOB_CARD_COMPT_AMT)   AS   SGG_CARD_COMPT_AMT
        ,AVG(SEOUL_WGT_RFLT_DSTNC_OJURI_TOU_NUM)   AS   SEOUL_WGT_RFLT_DSTNC_OJURI_TOU_NUM
        ,AVG(BUSAN_WGT_RFLT_DSTNC_OJURI_TOU_NUM)   AS   BUSAN_WGT_RFLT_DSTNC_OJURI_TOU_NUM
        ,AVG(DAEGU_WGT_RFLT_DSTNC_OJURI_TOU_NUM)   AS   DAEGU_WGT_RFLT_DSTNC_OJURI_TOU_NUM
        ,AVG(INCHEON_WGT_RFLT_DSTNC_OJURI_TOU_NUM)   AS   INCHEON_WGT_RFLT_DSTNC_OJURI_TOU_NUM
        ,AVG(GWANGJU_WGT_RFLT_DSTNC_OJURI_TOU_NUM)   AS   GWANGJU_WGT_RFLT_DSTNC_OJURI_TOU_NUM
        ,AVG(DAEJEON_WGT_RFLT_DSTNC_OJURI_TOU_NUM)   AS   DAEJEON_WGT_RFLT_DSTNC_OJURI_TOU_NUM
        ,AVG(ULSAN_WGT_RFLT_DSTNC_OJURI_TOU_NUM)   AS   ULSAN_WGT_RFLT_DSTNC_OJURI_TOU_NUM
        ,AVG(SEJONG_WGT_RFLT_DSTNC_OJURI_TOU_NUM)   AS   SEJONG_WGT_RFLT_DSTNC_OJURI_TOU_NUM
        ,AVG(GYEONGGI_WGT_RFLT_DSTNC_OJURI_TOU_NUM)   AS   GYEONGGI_WGT_RFLT_DSTNC_OJURI_TOU_NUM
        ,AVG(GANGWON_WGT_RFLT_DSTNC_OJURI_TOU_NUM)   AS   GANGWON_WGT_RFLT_DSTNC_OJURI_TOU_NUM
        ,AVG(CHUNGBUK_WGT_RFLT_DSTNC_OJURI_TOU_NUM)   AS   CHUNGBUK_WGT_RFLT_DSTNC_OJURI_TOU_NUM
        ,AVG(CHUNGNAM_WGT_RFLT_DSTNC_OJURI_TOU_NUM)   AS   CHUNGNAM_WGT_RFLT_DSTNC_OJURI_TOU_NUM
        ,AVG(JEONBUK_WGT_RFLT_DSTNC_OJURI_TOU_NUM)   AS   JEONBUK_WGT_RFLT_DSTNC_OJURI_TOU_NUM
        ,AVG(JEONNAM_WGT_RFLT_DSTNC_OJURI_TOU_NUM)   AS   JEONNAM_WGT_RFLT_DSTNC_OJURI_TOU_NUM
        ,AVG(GYEONGBUK_WGT_RFLT_DSTNC_OJURI_TOU_NUM)   AS   GYEONGBUK_WGT_RFLT_DSTNC_OJURI_TOU_NUM
        ,AVG(GYEONGNAM_WGT_RFLT_DSTNC_OJURI_TOU_NUM)   AS   GYEONGNAM_WGT_RFLT_DSTNC_OJURI_TOU_NUM
        ,AVG(JEJU_WGT_RFLT_DSTNC_OJURI_TOU_NUM)   AS   JEJU_WGT_RFLT_DSTNC_OJURI_TOU_NUM
        ,ROUND(AVG(SEOUL_WGT_RFLT_DSTNC_OJURI_TOU_NUM
            +BUSAN_WGT_RFLT_DSTNC_OJURI_TOU_NUM
            +DAEGU_WGT_RFLT_DSTNC_OJURI_TOU_NUM
            +INCHEON_WGT_RFLT_DSTNC_OJURI_TOU_NUM
            +GWANGJU_WGT_RFLT_DSTNC_OJURI_TOU_NUM
            +DAEJEON_WGT_RFLT_DSTNC_OJURI_TOU_NUM
            +ULSAN_WGT_RFLT_DSTNC_OJURI_TOU_NUM
            +SEJONG_WGT_RFLT_DSTNC_OJURI_TOU_NUM
            +GYEONGGI_WGT_RFLT_DSTNC_OJURI_TOU_NUM
            +GANGWON_WGT_RFLT_DSTNC_OJURI_TOU_NUM
            +CHUNGBUK_WGT_RFLT_DSTNC_OJURI_TOU_NUM
            +CHUNGNAM_WGT_RFLT_DSTNC_OJURI_TOU_NUM
            +JEONBUK_WGT_RFLT_DSTNC_OJURI_TOU_NUM
            +JEONNAM_WGT_RFLT_DSTNC_OJURI_TOU_NUM
            +GYEONGBUK_WGT_RFLT_DSTNC_OJURI_TOU_NUM
            +GYEONGNAM_WGT_RFLT_DSTNC_OJURI_TOU_NUM
            +JEJU_WGT_RFLT_DSTNC_OJURI_TOU_NUM),0)   AS   SGG_WGT_RFLT_DSTNC_TOU_NUM
   FROM    dw.`01_tou_act_info`
   WHERE LEFT(BASE_YM,4)=2023
   GROUP BY SGG_CD
   ) T101
ON T990.SGG_CD = T101.SGG_CD
LEFT OUTER JOIN
   (SELECT SGG_CD, AVG(CONT_TOU_NUM) AS SGG_CONT_TOU_NUM
   FROM 
      (SELECT  T02.SGG_CD, T01.*
      FROM    (SELECT *
            FROM  ods.`04_kt관광코드기본`
            WHERE BASE_YMD = '20230930' ) T02
      LEFT OUTER JOIN 
            (SELECT CONT_ID, BASE_YM, SUM(TOU_NUM) AS CONT_TOU_NUM
            FROM ods.`20_기초지자체지역별관광자원분포, 방문자월별집계` 
            WHERE LEFT(BASE_YM,4) = 2023
            GROUP BY CONT_ID, BASE_YM) T01
      ON T01.CONT_ID = T02.CONT_ID
      ) T001
   GROUP BY SGG_CD) T101_1
ON T990.SGG_CD = T101_1.SGG_CD
LEFT OUTER JOIN 
   (SELECT SGG_CD, AVG(AVG_AVG_LODG_DAYS) AS AVG_LODG_DAYS -- 시군구별 평균 숙박일수
   FROM 
      (SELECT BASE_YM, SGG_CD, SUM(TOU_NUM)/SUM(TOU_NUM/(LODG_DAYS+1)) AS AVG_AVG_LODG_DAYS -- 시군구,월별 평균숙박일수
      FROM ods.`19_기초지자체관광객숙박연월별집계` 
      WHERE  LODG_CD != 1
      AND    LEFT(BASE_YM, 4) = '2023'
      GROUP BY BASE_YM, SGG_CD
      ) T001
   GROUP BY T001.SGG_CD
   ) T101_2
ON T990.SGG_CD = T101_2.SGG_CD
LEFT OUTER JOIN
   (SELECT SGG_CD, AVG(AVG_WSL_TOU_STAY_TM) AS AVG_STAY_TM -- 시군구별 평균체류시간
   FROM 
      (SELECT BASE_YM, SGG_CD, SUM(TOU_NUM*WSL_TOU_STAY_TM)/SUM(TOU_NUM) AS AVG_WSL_TOU_STAY_TM -- 시군구,월별 평균체류시간
      FROM ods.`19_기초지자체관광객숙박연월별집계` 
      WHERE  LODG_CD = 1
      AND    LEFT(BASE_YM, 4) = '2023'
      GROUP BY BASE_YM, SGG_CD
      ) T001
   GROUP BY T001.SGG_CD) T101_3
ON T990.SGG_CD = T101_3.SGG_CD
LEFT OUTER JOIN 
   (SELECT SGG_CD
        ,NATUR_TAR_NUM   AS   NATUR_TAR_NUM
        ,ACAD_TAR_NUM   AS   ACAD_TAR_NUM
        ,RPTS_TAR_NUM   AS   RPTS_TAR_NUM
        ,SHPN_TAR_NUM   AS   SHPN_TAR_NUM
        ,FOOD_TAR_NUM   AS   FOOD_TAR_NUM
        ,LODG_TAR_NUM   AS   LODG_TAR_NUM
        ,NATUR_TAR_NUM+ACAD_TAR_NUM+RPTS_TAR_NUM+SHPN_TAR_NUM+FOOD_TAR_NUM+LODG_TAR_NUM   AS   SGG_TAR_NUM
        ,TOTL_BIZ_NUM   AS   TOTL_BIZ_NUM
        ,TOTL_TURSM_BIZ_NUM   AS   TOTL_TURSM_BIZ_NUM
        ,TURSM_SHPN_NUM   AS   TURSM_SHPN_NUM
        ,TURSM_TRS_NUM   AS   TURSM_TRS_NUM
        ,TURSM_LODG_NUM   AS   TURSM_LODG_NUM
        ,TURSM_FOOD_PUB_NUM   AS   TURSM_FOOD_PUB_NUM
        ,TOUR_ASSTN_SVC_NUM   AS   TOUR_ASSTN_SVC_NUM
        ,INTL_MTG_NUM   AS   INTL_MTG_NUM
        ,CLTUR_AMSMT_RPTS_IND_NUM   AS   CLTUR_AMSMT_RPTS_IND_NUM
        ,CSO_NUM   AS   CSO_NUM
        ,TOTL_WKER_NUM   AS   TOTL_WKER_NUM
        ,TOTL_MALE_WKER_NUM   AS   TOTL_MALE_WKER_NUM
        ,TOTL_FMALE_WKER_NUM   AS   TOTL_FMALE_WKER_NUM
        ,TOTL_TURSM_BIZ_WKER_NUM   AS   TOTL_TURSM_BIZ_WKER_NUM
        ,TOTL_TURSM_BIZ_MALE_WKER_NUM   AS   TOTL_TURSM_BIZ_MALE_WKER_NUM
        ,TOTL_TURSM_BIZ_FMALE_WKER_NUM   AS   TOTL_TURSM_BIZ_FMALE_WKER_NUM
        ,TURSM_SHPN_MALE_WKER_NUM   AS   TURSM_SHPN_MALE_WKER_NUM
        ,TURSM_SHPN_FMALE_WKER_NUM   AS   TURSM_SHPN_FMALE_WKER_NUM
        ,TURSM_TRS_MALE_WKER_NUM   AS   TURSM_TRS_MALE_WKER_NUM
        ,TURSM_TRS_FMALE_WKER_NUM   AS   TURSM_TRS_FMALE_WKER_NUM
        ,TURSM_LODG_MALE_WKER_NUM   AS   TURSM_LODG_MALE_WKER_NUM
        ,TURSM_LODG_FMALE_WKER_NUM   AS   TURSM_LODG_FMALE_WKER_NUM
        ,TURSM_FOOD_PUB_MALE_WKER_NUM   AS   TURSM_FOOD_PUB_MALE_WKER_NUM
        ,TURSM_FOOD_PUB_FMALE_WKER_NUM   AS   TURSM_FOOD_PUB_FMALE_WKER_NUM
        ,TOUR_ASSTN_SVC_MALE_WKER_NUM   AS   TOUR_ASSTN_SVC_MALE_WKER_NUM
        ,TOUR_ASSTN_SVC_FMALE_WKER_NUM   AS   TOUR_ASSTN_SVC_FMALE_WKER_NUM
        ,INTL_MTG_MALE_WKER_NUM   AS   INTL_MTG_MALE_WKER_NUM
        ,INTL_MTG_FMALE_WKER_NUM   AS   INTL_MTG_FMALE_WKER_NUM
        ,CLTUR_AMSMT_RPTS_IND_MALE_WKER_NUM   AS   CLTUR_AMSMT_RPTS_IND_MALE_WKER_NUM
        ,CLTUR_AMSMT_RPTS_IND_FMALE_WKER_NUM   AS   CLTUR_AMSMT_RPTS_IND_FMALE_WKER_NUM
        ,CSO_MALE_WKER_NUM   AS   CSO_MALE_WKER_NUM
        ,CSO_FMALE_WKER_NUM   AS   CSO_FMALE_WKER_NUM
        ,FSTV_NUM_SGG   AS   FSTV_NUM_SGG
        ,FSTV_NUM_SIDO   AS   FSTV_NUM_SIDO
        ,TURSM_BDGT   AS   TURSM_BDGT
        ,TOTL_BDGT   AS   TOTL_BDGT
        ,TOTL_BDGT_CPRS_TURSM_BDGT   AS   TOTL_BDGT_CPRS_TURSM_BDGT
        ,SOCTY_CORPO_NUM   AS   SOCTY_CORPO_NUM
        ,IFMD_NUM   AS   IFMD_NUM
        ,CLTUR_TURSM_EXPL_NUM   AS   CLTUR_TURSM_EXPL_NUM
        ,CT_TOUR_NUM_SGG   AS   CT_TOUR_NUM_SGG
        ,CT_TOUR_NUM_SIDO   AS   CT_TOUR_NUM_SIDO
        ,CAR_PUB_ZON_NUM   AS   CAR_PUB_ZON_NUM
        ,MRKT_TOTL_SHOP_NUM   AS   MRKT_TOTL_SHOP_NUM
        ,MRKT_EMT_SHOP_NUM   AS   MRKT_EMT_SHOP_NUM
        ,MRKT_EMT_SHOP_RAT   AS   MRKT_EMT_SHOP_RAT
        ,FSTV_NUM_SIDO+FSTV_NUM_SGG   AS   FSTV_NUM
        ,CT_TOUR_NUM_SGG + CT_TOUR_NUM_SIDO   AS   CT_TOUR_NUM
        ,TOTL_TURSM_BIZ_NUM/TOTL_BIZ_NUM   AS   TURSM_BIZ_RAT
        ,TOTL_TURSM_BIZ_WKER_NUM/TOTL_WKER_NUM   AS   TURSM_WKER_RAT
   FROM dw.`02_tursm_resr`) T102
ON    T990.SGG_CD = T102.SGG_CD 
LEFT OUTER JOIN 
   (SELECT T001.SGG_CD, T001.SGG_TAR_NUM/T002.TAR_NUM_AVG AS TAR_NUM_RAT
   FROM 
      (SELECT SGG_CD, (NATUR_TAR_NUM+ACAD_TAR_NUM+RPTS_TAR_NUM+SHPN_TAR_NUM+FOOD_TAR_NUM+LODG_TAR_NUM) AS SGG_TAR_NUM
      FROM dw.`02_tursm_resr`)T001,    (SELECT AVG(NATUR_TAR_NUM+ACAD_TAR_NUM+RPTS_TAR_NUM+SHPN_TAR_NUM+FOOD_TAR_NUM+LODG_TAR_NUM) AS TAR_NUM_AVG
      FROM dw.`02_tursm_resr` WHERE regn_ctgr!='일반지역') T002) T102_1
ON    T990.SGG_CD = T102_1.SGG_CD 
LEFT OUTER JOIN 
   dw.`03_ct_chrr` T103
ON    T990.SGG_CD = T103.SGG_CD   
LEFT OUTER JOIN 
   (SELECT SGG_CD, AVG(TOTL_NUM) AS SNS_MM_AVG_CNT
   FROM    
      (SELECT SGG_CD, SUBSTRING(BASE_YMD,1,6) AS BASE_YM, SUM(TOTL_NUM) AS TOTL_NUM
      FROM    dw.`04_01_PGS_ANA` 
      WHERE  BASE_YMD >= '20230101'
      GROUP BY SGG_CD, SUBSTRING(BASE_YMD,1,6)) T001
   GROUP BY SGG_CD) T104
ON    T990.SGG_CD = T104.SGG_CD
) T201
